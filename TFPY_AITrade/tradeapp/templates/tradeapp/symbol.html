{% extends "base.html" %}
{% load static %}

{% block title %}
Market {{sbl}}
{% endblock title %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
	<h1 class="h2">{{sbl}}</h1>
	<div class="btn-toolbar mb-2 mb-md-0">
		<div class="btn-group me-2">
			<button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
			<button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
		</div>
		<div class="dropdown">
			<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
				data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<span data-feather="calendar"></span>
				This week
			</button>
			<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
				<a class="dropdown-item disabled" href="#">Week</a>
				<a class="dropdown-item" href="#">Month</a>
				<a class="dropdown-item" href="#">Year</a>
			</div>
		</div>
	</div>
</div>

<div class="my-4 w-100" id="TVChart" width="900" height="380"></div>

<h2>Section title</h2>
<div class="table-responsive">
	<!-- https://docs.djangoproject.com/en/4.0/ref/templates/builtins/ -->
	<table class="table table-striped table-sm">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Header</th>
				<th scope="col">Header</th>
				<th scope="col">Header</th>
				<th scope="col">Header</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>1,001</td>
				<td>random</td>
				<td>data</td>
				<td>placeholder</td>
				<td>text</td>
			</tr>

		</tbody>
	</table>
</div>
{% endblock content %}

{% block scripts %}
{% comment %}
https://tradingview.github.io/lightweight-charts/
https://adamj.eu/tech/2020/02/18/safely-including-data-for-javascript-in-a-django-template/
https://www.youtube.com/watch?v=3KPW9VMyBHA
https://tradingview.github.io/lightweight-charts/docs
{% endcomment %}
{% comment %}

{% endcomment %}
<script type="text/javascript">
	const chartElement = document.getElementById('TVChart');
	var chart = LightweightCharts.createChart(chartElement, {
		width: 1540,
		height: 600,
		rightPriceScale: {
			scaleMargins: {
				top: 0.3,
				bottom: 0.25,
			},
			borderVisible: false,
		},
		layout: {
			backgroundColor: '#131722',
			textColor: '#d1d4dc',
		},
		grid: {
			vertLines: {
				color: 'rgba(42, 46, 57, 0)',
			},
			horzLines: {
				color: 'rgba(42, 46, 57, 0.6)',
			},
		},
	});

	var candlestickSeries = chart.addCandlestickSeries();

	var volumeSeries = chart.addHistogramSeries({
		color: '#26a69a',
		priceFormat: {
			type: 'volume',
		},
		priceScaleId: '',
		scaleMargins: {
			top: 0.8,
			bottom: 0,
		},
	});
	
	candlestickSeries.setData([{% for l in tickerData.itertuples %}
	{
		time: '{{ l.date }}',
		open: {{ l.open }},
		high: {{ l.high }},
		low: {{ l.low }},
		close: {{ l.close }}
	},
	{% endfor %}
	]);

	volumeSeries.setData([{% for l in tickerData.itertuples %}
	{ 
		time: '{{ l.date }}',
		value: {{ l.volume }},
		color: {% if l.close < l.open %} 'rgba(255,82,82, 0.8)' {% else %} 'rgba(0, 150, 136, 0.8)' {% endif %}
	},
	{% endfor %}
	]);
</script>
{% endblock scripts %}